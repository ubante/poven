#!/usr/bin/env python3

"""
This will simulate opening packs until I get two of each common, rare, and
epic cards.
"""
import argparse
import logging
import sys
import numpy as np

from projects.hearthstone.src.common import Collection, Card, Player, Store, Rarity


def set_logger(verbose_level):
    # Let there be debug.

    verbose_level = 0 if not verbose_level else verbose_level

    if verbose_level >= 2:
        logging_level = logging.DEBUG
    elif verbose_level == 1:
        logging_level = logging.INFO
    else:
        logging_level = logging.ERROR

    logging.basicConfig(level=logging_level,
                        stream=sys.stdout,
                        format='%(levelname)s - %(message)s')


def run_sim() -> int:
    me = Player("Moi")
    # me.collection.display()

    # for i in range(0, 200):
    #     me.open_pack()

    while not me.collection.is_solid():
        me.open_pack()

    me.collection.display()
    print(f"After opening {me.pack_count} packs:")
    me.collection.print_stats()

    return me.pack_count


def scratch():
    col = Collection()
    col.display()
    col.add(Store.get_random_card_of_rarity(col, Rarity.LEGENDARY))
    col.display()
    col.compact_display()


def binned_ascii_histogram(data, bins=5):
    hist, bin_edges = np.histogram(data, bins=bins)  # Compute histogram bins

    # Print histogram
    for count, edge in zip(hist, bin_edges[:-1]):  # Skip last bin edge
        print(f"{edge:4.1f} - {bin_edges[bin_edges.tolist().index(edge) + 1]:4.1f} | {'#' * count}")


def main():
    description = '''
This will simulate opening packs until I get all commons, rares, and epics.
'''
    epilog = '''
Examples:
    ./pack_sim.py
'''
    parser = argparse.ArgumentParser(description=description,
                                     epilog=epilog,
                                     formatter_class=argparse.RawDescriptionHelpFormatter)
    parser.add_argument("-v", "--verbose", help="Print info/debug.", action="count")
    args = parser.parse_args()

    # In this, DEBUG is mostly for entering and exiting methods/functions.  Use the other debug
    # flags for more verbose output.
    args.verbose = 1
    set_logger(args.verbose)
    logging.debug("Here we go.")

    counts = []
    sum_count = 0
    iterations = 1000
    for i in range (0, iterations):
        count = run_sim()
        print(f"It took {count} packs to get a pair of all non-legendaries. ")
        counts.append(count)
        sum_count += count

    print("\n----- Totals -----")
    print(counts)
    print(f"After {iterations} iterations, it took, on average, {sum_count/iterations} "
          f"packs to get a solid collection.")
    binned_ascii_histogram(counts, bins=10)

    # scratch()

if __name__ == "__main__":
    main()

"""
----- Totals -----
[291, 260, 302, 270, 289, 281, 303, 285, 267, 288, 272, 272, 289, 297, 296, 289, 269, 256, 274, 333, 296, 295, 234, 286, 285, 268, 296, 304, 280, 303, 291, 305, 285, 289, 252, 310, 276, 274, 256, 281, 303, 270, 289, 295, 327, 258, 299, 305, 269, 263, 287, 274, 280, 297, 290, 258, 282, 276, 277, 281, 289, 270, 281, 282, 271, 304, 287, 284, 277, 283, 300, 270, 272, 307, 288, 261, 289, 278, 323, 277, 236, 319, 277, 314, 336, 286, 275, 289, 283, 293, 263, 247, 272, 272, 270, 266, 283, 291, 277, 275]
After 100 iterations, it took, on average, 283.46 packs to get a solid collection.
234.0 - 244.2 | ##
244.2 - 254.4 | ##
254.4 - 264.6 | ########
264.6 - 274.8 | ###################
274.8 - 285.0 | ######################
285.0 - 295.2 | ########################
295.2 - 305.4 | ###############
305.4 - 315.6 | ###
315.6 - 325.8 | ##
325.8 - 336.0 | ###

----- Totals -----
[259, 252, 280, 268, 258, 278, 241, 290, 287, 262, 250, 277, 259, 301, 279, 304, 288, 279, 311, 317, 242, 285, 270, 270, 288, 284, 283, 287, 249, 266, 280, 277, 284, 278, 295, 265, 303, 291, 302, 276, 292, 274, 316, 287, 308, 265, 299, 270, 270, 290, 289, 295, 295, 303, 273, 279, 267, 291, 321, 287, 279, 298, 314, 274, 299, 285, 282, 275, 293, 277, 282, 287, 291, 288, 272, 264, 282, 271, 288, 298, 279, 268, 269, 282, 275, 250, 262, 281, 271, 283, 285, 333, 241, 277, 278, 262, 295, 265, 271, 292, 299, 258, 263, 273, 290, 262, 315, 276, 303, 264, 280, 242, 283, 312, 284, 249, 288, 277, 299, 293, 292, 281, 288, 261, 335, 258, 291, 297, 321, 269, 280, 251, 282, 278, 269, 288, 268, 272, 280, 291, 267, 290, 307, 279, 303, 299, 324, 275, 307, 289, 278, 283, 276, 300, 261, 317, 287, 310, 279, 265, 289, 255, 252, 269, 255, 279, 298, 313, 302, 314, 299, 274, 264, 254, 275, 239, 282, 276, 282, 291, 266, 277, 261, 267, 274, 281, 267, 245, 268, 254, 297, 266, 277, 273, 247, 316, 281, 325, 311, 285, 312, 276, 320, 252, 257, 297, 282, 290, 329, 256, 253, 255, 263, 300, 284, 291, 267, 284, 268, 284, 284, 264, 291, 283, 286, 268, 319, 300, 258, 273, 289, 267, 256, 296, 303, 309, 305, 251, 294, 286, 250, 268, 326, 245, 300, 290, 250, 261, 268, 254, 288, 273, 280, 302, 327, 274, 282, 295, 277, 287, 262, 294, 266, 262, 275, 266, 289, 276, 278, 272, 283, 267, 296, 254, 263, 275, 258, 276, 279, 264, 299, 258, 246, 271, 282, 260, 276, 248, 270, 233, 267, 285, 265, 299, 317, 278, 293, 278, 251, 251, 291, 282, 265, 275, 292, 313, 281, 278, 273, 284, 285, 290, 265, 293, 262, 286, 262, 287, 280, 266, 293, 283, 283, 274, 245, 312, 275, 295, 272, 300, 263, 315, 275, 262, 290, 288, 261, 295, 269, 307, 297, 287, 278, 296, 269, 257, 238, 283, 311, 268, 225, 266, 267, 264, 262, 282, 263, 244, 329, 322, 270, 239, 291, 290, 312, 331, 254, 279, 295, 279, 305, 295, 273, 305, 287, 255, 308, 307, 276, 257, 251, 270, 247, 270, 269, 278, 266, 281, 284, 339, 272, 291, 293, 284, 270, 257, 294, 281, 259, 275, 303, 296, 323, 295, 241, 264, 303, 261, 265, 290, 263, 254, 292, 282, 270, 256, 299, 273, 287, 297, 255, 293, 295, 278, 308, 254, 302, 291, 286, 276, 263, 308, 315, 275, 293, 282, 231, 261, 292, 293, 260, 272, 286, 272, 277, 276, 302, 301, 269, 305, 293, 259, 298, 300, 290, 301, 276, 304, 280, 242, 286, 288, 318, 255, 282, 285, 292, 276, 296, 269, 264, 264, 264, 301, 294, 285, 283, 273, 280, 287, 322, 313, 296, 307, 301, 265, 311, 256, 317, 268, 276, 266, 301, 311, 245, 296, 270, 335, 270, 250, 230, 259, 280, 288, 299, 284, 266, 268, 235, 289, 276, 293, 250, 257, 274, 236, 302, 277, 262, 280, 298, 290, 308, 289, 280, 324, 266, 272, 278, 260, 279, 258, 279, 286, 267, 273, 276, 332, 324, 275, 277, 297, 264, 260, 281, 268, 296, 274, 270, 249, 304, 266, 268, 274, 267, 281, 257, 281, 282, 270, 259, 269, 270, 306, 293, 278, 282, 269, 301, 286, 296, 272, 280, 280, 290, 277, 267, 271, 271, 263, 277, 277, 255, 269, 281, 275, 272, 258, 241, 294, 290, 277, 258, 268, 275, 309, 283, 315, 259, 289, 280, 289, 276, 284, 242, 260, 287, 285, 262, 310, 265, 253, 289, 273, 263, 272, 287, 305, 285, 277, 282, 277, 269, 296, 290, 288, 262, 277, 296, 305, 266, 305, 273, 257, 254, 298, 297, 280, 263, 272, 287, 275, 346, 279, 303, 298, 302, 242, 287, 255, 290, 281, 295, 264, 266, 299, 246, 282, 254, 255, 280, 292, 256, 278, 282, 245, 262, 305, 285, 227, 265, 293, 270, 269, 278, 265, 289, 286, 291, 282, 285, 290, 283, 252, 309, 276, 272, 288, 278, 290, 262, 294, 317, 323, 292, 319, 280, 268, 270, 290, 317, 315, 308, 278, 282, 325, 305, 271, 282, 305, 286, 272, 325, 322, 287, 279, 271, 337, 273, 268, 302, 283, 324, 294, 323, 273, 254, 254, 271, 286, 255, 277, 280, 253, 305, 273, 272, 255, 290, 289, 292, 278, 263, 276, 281, 307, 277, 248, 303, 275, 276, 275, 248, 286, 324, 287, 353, 272, 299, 282, 264, 275, 297, 265, 279, 286, 283, 282, 273, 264, 280, 309, 244, 272, 272, 284, 274, 234, 280, 252, 259, 287, 273, 301, 289, 277, 301, 292, 354, 272, 303, 287, 290, 272, 236, 278, 311, 290, 291, 274, 287, 275, 276, 284, 310, 287, 290, 307, 250, 289, 240, 268, 259, 305, 303, 323, 320, 312, 309, 270, 282, 261, 288, 284, 328, 289, 261, 297, 267, 285, 304, 319, 308, 255, 272, 282, 287, 265, 255, 263, 285, 289, 311, 284, 297, 268, 246, 253, 277, 297, 271, 261, 280, 280, 256, 302, 300, 283, 254, 307, 248, 293, 276, 284, 268, 285, 271, 263, 273, 292, 289, 242, 289, 298, 281, 258, 276, 280, 263, 295, 265, 317, 270, 315, 273, 296, 279, 281, 298, 291, 258, 295, 263, 251, 275, 276, 276, 292, 278, 298, 275, 292, 320, 284, 270, 312, 304, 299, 278, 287, 314, 291, 286, 275, 287, 311, 299, 286, 273, 287, 271, 279, 237, 258, 273, 293, 277, 272, 321, 283, 243, 269, 277, 261, 328, 294, 259, 300, 266, 328, 317, 276, 338, 242, 290, 276, 266, 275, 270, 256, 290, 269, 247, 287, 303, 259, 280, 254, 305, 263, 321, 276, 271, 273, 276, 246, 265, 281, 288, 308, 272, 269, 284, 277, 262, 246, 292, 274, 265, 282, 269, 266, 284, 285, 274, 282, 276, 300, 285, 268, 259, 260, 273, 288, 309, 280, 297, 259, 283, 290]
After 1000 iterations, it took, on average, 280.819 packs to get a solid collection.
225.0 - 237.9 | ##########
237.9 - 250.8 | #############################################
250.8 - 263.7 | #################################################################################################################################
263.7 - 276.6 | #####################################################################################################################################################################################################################################################
276.6 - 289.5 | ##########################################################################################################################################################################################################################################################################
289.5 - 302.4 | #########################################################################################################################################################################
302.4 - 315.3 | ##################################################################################
315.3 - 328.2 | #########################################
328.2 - 341.1 | ##########
341.1 - 354.0 | ###
"""



