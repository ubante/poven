#!/usr/bin/env python3

"""
This will simulate opening packs until I get two of each common, rare, and
epic cards.
"""
import argparse
import logging
import sys
import numpy as np

from projects.hearthstone.src.common import Collection, Card, Player, Store, Rarity


def set_logger(verbose_level):
    # Let there be debug.

    verbose_level = 0 if not verbose_level else verbose_level

    if verbose_level >= 2:
        logging_level = logging.DEBUG
    elif verbose_level == 1:
        logging_level = logging.INFO
    else:
        logging_level = logging.ERROR

    logging.basicConfig(level=logging_level,
                        stream=sys.stdout,
                        format='%(levelname)s - %(message)s')


def run_sim(compact=False, dashes=False) -> int:
    me = Player("Moi")

    for i in range(0, 1000):
        me.open_pack()

        if dashes:
            me.collection.compact_display()

        if me.collection.can_craft_missing_cards:
            break

    # while not me.collection.is_solid():
    #     me.open_pack()

    if compact:
        print(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")
    else:
        me.collection.display()
    print(f"After opening {me.pack_count} packs:")
    me.collection.print_stats()

    return me.pack_count


def scratch():
    col = Collection()
    col.display()
    col.add(Store.get_random_card_of_rarity(col, Rarity.LEGENDARY))
    col.display()
    col.compact_display()


def binned_ascii_histogram(data, bins=5):
    hist, bin_edges = np.histogram(data, bins=bins)  # Compute histogram bins

    # Print histogram
    for count, edge in zip(hist, bin_edges[:-1]):  # Skip last bin edge
        print(f"{edge:4.1f} - {bin_edges[bin_edges.tolist().index(edge) + 1]:4.1f} | {'#' * count}")


def main():
    description = '''
This will simulate opening packs until I get all commons, rares, and epics.
'''
    epilog = '''
Examples:
    ./pack_sim.py
'''
    parser = argparse.ArgumentParser(description=description,
                                     epilog=epilog,
                                     formatter_class=argparse.RawDescriptionHelpFormatter)
    parser.add_argument("-v", "--verbose", help="Print info/debug.", action="count")
    args = parser.parse_args()

    # In this, DEBUG is mostly for entering and exiting methods/functions.  Use the other debug
    # flags for more verbose output.
    args.verbose = 1
    set_logger(args.verbose)
    logging.debug("Here we go.")

    counts = []
    sum_count = 0
    iterations = 10
    for i in range (0, iterations):
        count = run_sim(compact=True)
        print(f"It took {count} packs to get a fully complete collection. ")
        counts.append(count)
        sum_count += count

    print("\n----- Totals -----")
    print(counts)
    print(f"After {iterations} iterations, it took, on average, {sum_count/iterations} "
          f"packs to get a fully complete collection.")
    binned_ascii_histogram(counts, bins=10)

    # scratch()

if __name__ == "__main__":
    main()

"""
----- Totals -----
[291, 260, 302, 270, 289, 281, 303, 285, 267, 288, 272, 272, 289, 297, 296, 289, 269, 256, 274, 333, 296, 295, 234, 286, 285, 268, 296, 304, 280, 303, 291, 305, 285, 289, 252, 310, 276, 274, 256, 281, 303, 270, 289, 295, 327, 258, 299, 305, 269, 263, 287, 274, 280, 297, 290, 258, 282, 276, 277, 281, 289, 270, 281, 282, 271, 304, 287, 284, 277, 283, 300, 270, 272, 307, 288, 261, 289, 278, 323, 277, 236, 319, 277, 314, 336, 286, 275, 289, 283, 293, 263, 247, 272, 272, 270, 266, 283, 291, 277, 275]
After 100 iterations, it took, on average, 283.46 packs to get a solid collection.
234.0 - 244.2 | ##
244.2 - 254.4 | ##
254.4 - 264.6 | ########
264.6 - 274.8 | ###################
274.8 - 285.0 | ######################
285.0 - 295.2 | ########################
295.2 - 305.4 | ###############
305.4 - 315.6 | ###
315.6 - 325.8 | ##
325.8 - 336.0 | ###

----- Totals -----
[259, 252, 280, 268, 258, 278, 241, 290, 287, 262, 250, 277, 259, 301, 279, 304, 288, 279, 311, 317, 242, 285, 270, 270, 288, 284, 283, 287, 249, 266, 280, 277, 284, 278, 295, 265, 303, 291, 302, 276, 292, 274, 316, 287, 308, 265, 299, 270, 270, 290, 289, 295, 295, 303, 273, 279, 267, 291, 321, 287, 279, 298, 314, 274, 299, 285, 282, 275, 293, 277, 282, 287, 291, 288, 272, 264, 282, 271, 288, 298, 279, 268, 269, 282, 275, 250, 262, 281, 271, 283, 285, 333, 241, 277, 278, 262, 295, 265, 271, 292, 299, 258, 263, 273, 290, 262, 315, 276, 303, 264, 280, 242, 283, 312, 284, 249, 288, 277, 299, 293, 292, 281, 288, 261, 335, 258, 291, 297, 321, 269, 280, 251, 282, 278, 269, 288, 268, 272, 280, 291, 267, 290, 307, 279, 303, 299, 324, 275, 307, 289, 278, 283, 276, 300, 261, 317, 287, 310, 279, 265, 289, 255, 252, 269, 255, 279, 298, 313, 302, 314, 299, 274, 264, 254, 275, 239, 282, 276, 282, 291, 266, 277, 261, 267, 274, 281, 267, 245, 268, 254, 297, 266, 277, 273, 247, 316, 281, 325, 311, 285, 312, 276, 320, 252, 257, 297, 282, 290, 329, 256, 253, 255, 263, 300, 284, 291, 267, 284, 268, 284, 284, 264, 291, 283, 286, 268, 319, 300, 258, 273, 289, 267, 256, 296, 303, 309, 305, 251, 294, 286, 250, 268, 326, 245, 300, 290, 250, 261, 268, 254, 288, 273, 280, 302, 327, 274, 282, 295, 277, 287, 262, 294, 266, 262, 275, 266, 289, 276, 278, 272, 283, 267, 296, 254, 263, 275, 258, 276, 279, 264, 299, 258, 246, 271, 282, 260, 276, 248, 270, 233, 267, 285, 265, 299, 317, 278, 293, 278, 251, 251, 291, 282, 265, 275, 292, 313, 281, 278, 273, 284, 285, 290, 265, 293, 262, 286, 262, 287, 280, 266, 293, 283, 283, 274, 245, 312, 275, 295, 272, 300, 263, 315, 275, 262, 290, 288, 261, 295, 269, 307, 297, 287, 278, 296, 269, 257, 238, 283, 311, 268, 225, 266, 267, 264, 262, 282, 263, 244, 329, 322, 270, 239, 291, 290, 312, 331, 254, 279, 295, 279, 305, 295, 273, 305, 287, 255, 308, 307, 276, 257, 251, 270, 247, 270, 269, 278, 266, 281, 284, 339, 272, 291, 293, 284, 270, 257, 294, 281, 259, 275, 303, 296, 323, 295, 241, 264, 303, 261, 265, 290, 263, 254, 292, 282, 270, 256, 299, 273, 287, 297, 255, 293, 295, 278, 308, 254, 302, 291, 286, 276, 263, 308, 315, 275, 293, 282, 231, 261, 292, 293, 260, 272, 286, 272, 277, 276, 302, 301, 269, 305, 293, 259, 298, 300, 290, 301, 276, 304, 280, 242, 286, 288, 318, 255, 282, 285, 292, 276, 296, 269, 264, 264, 264, 301, 294, 285, 283, 273, 280, 287, 322, 313, 296, 307, 301, 265, 311, 256, 317, 268, 276, 266, 301, 311, 245, 296, 270, 335, 270, 250, 230, 259, 280, 288, 299, 284, 266, 268, 235, 289, 276, 293, 250, 257, 274, 236, 302, 277, 262, 280, 298, 290, 308, 289, 280, 324, 266, 272, 278, 260, 279, 258, 279, 286, 267, 273, 276, 332, 324, 275, 277, 297, 264, 260, 281, 268, 296, 274, 270, 249, 304, 266, 268, 274, 267, 281, 257, 281, 282, 270, 259, 269, 270, 306, 293, 278, 282, 269, 301, 286, 296, 272, 280, 280, 290, 277, 267, 271, 271, 263, 277, 277, 255, 269, 281, 275, 272, 258, 241, 294, 290, 277, 258, 268, 275, 309, 283, 315, 259, 289, 280, 289, 276, 284, 242, 260, 287, 285, 262, 310, 265, 253, 289, 273, 263, 272, 287, 305, 285, 277, 282, 277, 269, 296, 290, 288, 262, 277, 296, 305, 266, 305, 273, 257, 254, 298, 297, 280, 263, 272, 287, 275, 346, 279, 303, 298, 302, 242, 287, 255, 290, 281, 295, 264, 266, 299, 246, 282, 254, 255, 280, 292, 256, 278, 282, 245, 262, 305, 285, 227, 265, 293, 270, 269, 278, 265, 289, 286, 291, 282, 285, 290, 283, 252, 309, 276, 272, 288, 278, 290, 262, 294, 317, 323, 292, 319, 280, 268, 270, 290, 317, 315, 308, 278, 282, 325, 305, 271, 282, 305, 286, 272, 325, 322, 287, 279, 271, 337, 273, 268, 302, 283, 324, 294, 323, 273, 254, 254, 271, 286, 255, 277, 280, 253, 305, 273, 272, 255, 290, 289, 292, 278, 263, 276, 281, 307, 277, 248, 303, 275, 276, 275, 248, 286, 324, 287, 353, 272, 299, 282, 264, 275, 297, 265, 279, 286, 283, 282, 273, 264, 280, 309, 244, 272, 272, 284, 274, 234, 280, 252, 259, 287, 273, 301, 289, 277, 301, 292, 354, 272, 303, 287, 290, 272, 236, 278, 311, 290, 291, 274, 287, 275, 276, 284, 310, 287, 290, 307, 250, 289, 240, 268, 259, 305, 303, 323, 320, 312, 309, 270, 282, 261, 288, 284, 328, 289, 261, 297, 267, 285, 304, 319, 308, 255, 272, 282, 287, 265, 255, 263, 285, 289, 311, 284, 297, 268, 246, 253, 277, 297, 271, 261, 280, 280, 256, 302, 300, 283, 254, 307, 248, 293, 276, 284, 268, 285, 271, 263, 273, 292, 289, 242, 289, 298, 281, 258, 276, 280, 263, 295, 265, 317, 270, 315, 273, 296, 279, 281, 298, 291, 258, 295, 263, 251, 275, 276, 276, 292, 278, 298, 275, 292, 320, 284, 270, 312, 304, 299, 278, 287, 314, 291, 286, 275, 287, 311, 299, 286, 273, 287, 271, 279, 237, 258, 273, 293, 277, 272, 321, 283, 243, 269, 277, 261, 328, 294, 259, 300, 266, 328, 317, 276, 338, 242, 290, 276, 266, 275, 270, 256, 290, 269, 247, 287, 303, 259, 280, 254, 305, 263, 321, 276, 271, 273, 276, 246, 265, 281, 288, 308, 272, 269, 284, 277, 262, 246, 292, 274, 265, 282, 269, 266, 284, 285, 274, 282, 276, 300, 285, 268, 259, 260, 273, 288, 309, 280, 297, 259, 283, 290]
After 1000 iterations, it took, on average, 280.819 packs to get a solid collection.
225.0 - 237.9 | ##########
237.9 - 250.8 | #############################################
250.8 - 263.7 | #################################################################################################################################
263.7 - 276.6 | #####################################################################################################################################################################################################################################################
276.6 - 289.5 | ##########################################################################################################################################################################################################################################################################
289.5 - 302.4 | #########################################################################################################################################################################
302.4 - 315.3 | ##################################################################################
315.3 - 328.2 | #########################################
328.2 - 341.1 | ##########
341.1 - 354.0 | ###

# After accounting for disenchanting extras to craft missing cards:
----- Totals -----
[251, 242, 325, 243, 269, 279, 262, 243, 273, 271, 287, 261, 265, 282, 249, 246, 259, 270, 275, 259, 260, 229, 273, 278, 278, 286, 250, 256, 275, 235, 261, 313, 270, 283, 272, 269, 261, 277, 267, 281, 273, 282, 276, 270, 218, 272, 258, 261, 265, 260, 329, 248, 276, 285, 291, 246, 264, 242, 296, 261, 243, 274, 295, 298, 263, 281, 266, 237, 265, 250, 241, 271, 293, 252, 247, 266, 282, 259, 261, 252, 296, 303, 247, 274, 241, 271, 248, 247, 260, 274, 268, 263, 261, 253, 247, 296, 273, 245, 284, 268]
After 100 iterations, it took, on average, 266.73 packs to get a fully complete collection.
218.0 - 229.1 | ##
229.1 - 240.2 | ##
240.2 - 251.3 | ####################
251.3 - 262.4 | ###################
262.4 - 273.5 | #########################
273.5 - 284.6 | ##################
284.6 - 295.7 | ######
295.7 - 306.8 | #####
306.8 - 317.9 | #
317.9 - 329.0 | ##

----- Totals -----
[259, 255, 298, 260, 291, 265, 264, 268, 261, 264, 246, 268, 246, 271, 257, 268, 266, 302, 267, 235, 257, 267, 257, 264, 252, 320, 264, 256, 295, 300, 253, 260, 249, 248, 250, 253, 261, 271, 296, 267, 294, 265, 276, 248, 305, 251, 260, 268, 238, 273, 294, 260, 319, 246, 262, 255, 286, 306, 278, 279, 258, 248, 259, 288, 260, 267, 296, 287, 261, 294, 270, 278, 289, 292, 263, 286, 302, 268, 257, 278, 266, 249, 237, 252, 261, 306, 254, 249, 270, 256, 296, 274, 290, 259, 297, 270, 277, 259, 271, 259, 282, 252, 243, 292, 307, 221, 259, 283, 318, 269, 242, 243, 261, 262, 264, 296, 284, 267, 258, 272, 261, 280, 240, 317, 233, 282, 267, 276, 308, 296, 261, 282, 264, 242, 316, 266, 267, 241, 245, 312, 296, 246, 251, 261, 281, 298, 261, 272, 261, 261, 235, 261, 295, 265, 251, 311, 290, 252, 259, 297, 273, 265, 281, 253, 242, 257, 280, 261, 286, 267, 260, 254, 295, 262, 290, 281, 264, 260, 261, 259, 296, 283, 245, 247, 246, 259, 252, 297, 264, 282, 286, 264, 260, 274, 246, 277, 310, 269, 272, 260, 274, 286, 235, 274, 334, 264, 251, 277, 254, 252, 282, 281, 241, 250, 259, 260, 258, 251, 266, 234, 258, 271, 254, 260, 306, 295, 295, 311, 256, 271, 271, 275, 265, 230, 255, 250, 270, 268, 275, 260, 242, 233, 281, 282, 295, 296, 237, 246, 251, 308, 295, 257, 260, 239, 253, 259, 253, 257, 283, 276, 271, 244, 266, 272, 260, 260, 258, 254, 259, 257, 261, 250, 261, 288, 299, 232, 236, 270, 276, 242, 285, 260, 270, 272, 316, 298, 272, 257, 265, 226, 293, 261, 243, 275, 271, 237, 247, 264, 267, 295, 324, 288, 261, 283, 243, 267, 315, 246, 254, 296, 275, 228, 260, 285, 261, 284, 241, 297, 272, 264, 273, 271, 246, 248, 237, 277, 279, 313, 260, 250, 252, 269, 255, 280, 301, 259, 278, 333, 292, 239, 273, 284, 271, 305, 294, 298, 269, 252, 258, 284, 247, 334, 260, 312, 265, 254, 257, 258, 286, 274, 271, 288, 287, 261, 295, 266, 312, 272, 292, 268, 279, 290, 251, 258, 278, 301, 258, 244, 286, 259, 280, 263, 238, 269, 259, 233, 322, 269, 229, 225, 258, 264, 247, 304, 263, 260, 262, 269, 260, 294, 265, 232, 265, 263, 272, 276, 239, 272, 258, 264, 259, 252, 288, 251, 263, 282, 266, 266, 246, 273, 259, 296, 258, 296, 251, 280, 269, 237, 243, 284, 289, 291, 266, 291, 246, 265, 305, 259, 266, 295, 299, 259, 288, 278, 258, 228, 301, 291, 271, 248, 235, 277, 254, 284, 262, 250, 276, 256, 255, 262, 262, 263, 274, 294, 259, 259, 252, 333, 267, 261, 262, 278, 266, 287, 268, 253, 296, 258, 270, 276, 261, 233, 267, 270, 279, 248, 260, 258, 253, 261, 288, 265, 255, 293, 288, 262, 330, 248, 264, 261, 255, 251, 275, 253, 255, 279, 269, 296, 238, 257, 245, 295, 274, 261, 301, 275, 284, 291, 298, 257, 234, 260, 283, 259, 261, 260, 257, 267, 324, 253, 251, 260, 232, 259, 263, 272, 240, 246, 248, 257, 265, 272, 273, 248, 265, 252, 273, 251, 254, 297, 260, 306, 260, 265, 282, 260, 273, 257, 257, 261, 252, 251, 291, 273, 281, 240, 268, 285, 255, 287, 288, 271, 259, 296, 262, 251, 275, 260, 288, 244, 276, 266, 278, 275, 289, 287, 252, 242, 367, 247, 267, 267, 297, 284, 314, 236, 258, 280, 250, 296, 276, 281, 251, 277, 276, 248, 251, 294, 261, 253, 294, 319, 268, 246, 264, 296, 233, 272, 263, 274, 253, 287, 246, 272, 270, 262, 295, 238, 250, 247, 289, 288, 248, 265, 270, 268, 272, 287, 243, 275, 288, 293, 269, 299, 297, 256, 298, 271, 265, 255, 260, 279, 273, 262, 261, 291, 279, 304, 277, 252, 304, 296, 258, 275, 260, 295, 266, 276, 258, 293, 243, 296, 296, 245, 278, 287, 245, 298, 298, 262, 293, 238, 281, 266, 261, 276, 264, 265, 263, 265, 261, 265, 259, 258, 246, 245, 267, 270, 248, 264, 289, 276, 265, 250, 271, 267, 283, 278, 256, 264, 272, 262, 256, 292, 244, 286, 248, 259, 261, 255, 248, 281, 239, 288, 296, 237, 257, 255, 274, 262, 259, 276, 266, 283, 269, 271, 277, 260, 272, 248, 261, 277, 255, 252, 257, 245, 258, 252, 253, 262, 273, 288, 268, 263, 244, 266, 267, 258, 290, 286, 248, 260, 256, 294, 295, 287, 273, 287, 256, 284, 243, 262, 260, 264, 258, 259, 266, 275, 305, 296, 277, 258, 309, 260, 314, 299, 289, 260, 266, 280, 279, 286, 240, 261, 244, 241, 260, 230, 278, 245, 251, 289, 238, 237, 262, 252, 298, 261, 258, 245, 259, 258, 269, 271, 298, 263, 265, 260, 250, 296, 272, 289, 274, 257, 244, 249, 265, 287, 258, 225, 291, 260, 282, 242, 260, 257, 259, 230, 261, 281, 239, 275, 296, 256, 268, 296, 242, 262, 283, 266, 254, 317, 286, 282, 290, 258, 248, 264, 259, 310, 299, 297, 267, 271, 288, 296, 252, 267, 286, 247, 296, 293, 261, 265, 290, 270, 240, 265, 248, 298, 260, 260, 270, 275, 270, 258, 258, 261, 284, 271, 295, 271, 282, 237, 256, 324, 306, 256, 276, 296, 290, 303, 263, 286, 333, 260, 275, 258, 222, 277, 245, 242, 242, 261, 298, 266, 264, 286, 253, 243, 260, 259, 287, 243, 254, 263, 283, 284, 297, 241, 293, 260, 249, 250, 261, 282, 245, 257, 323, 273, 249, 293, 252, 261, 257, 247, 272, 258, 285, 289, 264, 304, 296, 291, 295, 282, 297, 264, 265, 258, 312, 254, 241, 262, 306, 273, 242, 252, 261, 257, 247, 262, 259, 284, 282, 266, 274, 265, 297, 259, 244, 277, 284, 268, 250, 231, 268, 249, 297, 289, 239, 278, 278, 241, 312, 244, 285, 247, 261, 317]
After 1000 iterations, it took, on average, 268.958 packs to get a fully complete collection.
221.0 - 235.6 | ##########################
235.6 - 250.2 | #########################################################################################################################################
250.2 - 264.8 | ##################################################################################################################################################################################################################################################################################################################################
264.8 - 279.4 | ##########################################################################################################################################################################################################################################
279.4 - 294.0 | ###########################################################################################################################################
294.0 - 308.6 | ###########################################################################################################
308.6 - 323.2 | #########################
323.2 - 337.8 | #########
337.8 - 352.4 | 
352.4 - 367.0 | #
"""



